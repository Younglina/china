import{c as A,T as ee,ai as de,m as I,n as B,d as U,aj as me,ak as ge,a as l,I as V,O as M,w as G,p as L,v as Y,U as ve,b as D,R as q,$ as fe,z as E,ac as oe,J as he,D as te,N as K,a0 as we,al as Pe,S as O,am as H,x as ae,K as Se,P as X,an as ye,A as be,B as xe,aa as Ie,ao as Te,q as N,V as Q,ap as Ce,a7 as ze,a6 as $e}from"./index-021851cb.js";import{L as ne,u as Be,a as Re,P as ke,m as Ze,f as De}from"./function-call-4f99f67f.js";import{S as Le,a as Ee}from"./index-265a5c64.js";const[Xe,R]=A("button"),Ye=ee({},de,{tag:I("button"),text:String,icon:String,type:I("default"),size:I("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:I("button"),loadingSize:B,loadingText:String,loadingType:String,iconPosition:I("left")});var _e=U({name:Xe,props:Ye,emits:["click"],setup(e,{emit:u,slots:r}){const o=me(),n=()=>r.loading?r.loading():l(ne,{size:e.loadingSize,type:e.loadingType,class:R("loading")},null),m=()=>{if(e.loading)return n();if(r.icon)return l("div",{class:R("icon")},[r.icon()]);if(e.icon)return l(V,{name:e.icon,class:R("icon"),classPrefix:e.iconPrefix},null)},f=()=>{let s;if(e.loading?s=e.loadingText:s=r.default?r.default():e.text,s)return l("span",{class:R("text")},[s])},T=()=>{const{color:s,plain:h}=e;if(s){const g={color:h?s:"white"};return h||(g.background=s),s.includes("gradient")?g.border=0:g.borderColor=s,g}},v=s=>{e.loading?M(s):e.disabled||(u("click",s),o())};return()=>{const{tag:s,type:h,size:g,block:$,round:S,plain:y,square:b,loading:a,disabled:w,hairline:i,nativeType:x,iconPosition:P}=e,j=[R([h,g,{plain:y,block:$,round:S,square:b,loading:a,disabled:w,hairline:i}]),{[ge]:i}];return l(s,{type:x,class:j,style:T(),disabled:w,onClick:v},{default:()=>[l("div",{class:R("content")},[P==="left"&&m(),f(),P==="right"&&m()])]})}}});const Je=G(_e),[He,k]=A("image"),Ne={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:B,height:B,radius:B,lazyLoad:Boolean,iconSize:B,showError:L,errorIcon:I("photo-fail"),iconPrefix:String,showLoading:L,loadingIcon:I("photo")};var Me=U({name:He,props:Ne,emits:["load","error"],setup(e,{emit:u,slots:r}){const o=Y(!1),n=Y(!0),m=Y(),{$Lazyload:f}=ve().proxy,T=D(()=>{const a={width:q(e.width),height:q(e.height)};return fe(e.radius)&&(a.overflow="hidden",a.borderRadius=q(e.radius)),a});E(()=>e.src,()=>{o.value=!1,n.value=!0});const v=a=>{n.value&&(n.value=!1,u("load",a))},s=()=>{const a=new Event("load");Object.defineProperty(a,"target",{value:m.value,enumerable:!0}),v(a)},h=a=>{o.value=!0,n.value=!1,u("error",a)},g=(a,w,i)=>i?i():l(V,{name:a,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),$=()=>{if(n.value&&e.showLoading)return l("div",{class:k("loading")},[g(e.loadingIcon,k("loading-icon"),r.loading)]);if(o.value&&e.showError)return l("div",{class:k("error")},[g(e.errorIcon,k("error-icon"),r.error)])},S=()=>{if(o.value||!e.src)return;const a={alt:e.alt,class:k("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?we(l("img",O({ref:m},a),null),[[Pe("lazy"),e.src]]):l("img",O({ref:m,src:e.src,onLoad:v,onError:h},a),null)},y=({el:a})=>{const w=()=>{a===m.value&&n.value&&s()};m.value?w():K(w)},b=({el:a})=>{a===m.value&&!o.value&&h()};return f&&oe&&(f.$on("loaded",y),f.$on("error",b),he(()=>{f.$off("loaded",y),f.$off("error",b)})),te(()=>{K(()=>{var a;(a=m.value)!=null&&a.complete&&s()})}),()=>{var a;return l("div",{class:k({round:e.round,block:e.block}),style:T.value},[S(),$(),(a=r.default)==null?void 0:a.call(r)])}}});const We=G(Me),p=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),F=A("image-preview")[1];var Oe=U({props:{src:String,show:Boolean,active:Number,minZoom:H(B),maxZoom:H(B),rootWidth:H(Number),rootHeight:H(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:u,slots:r}){const o=ae({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=Be(),m=Y(),f=D(()=>{const{rootWidth:t,rootHeight:c}=e,d=c/t;return o.imageRatio>d}),T=D(()=>{const{scale:t,moveX:c,moveY:d,moving:C,zooming:z}=o,_={transitionDuration:z||C?"0s":".3s"};if(t!==1){const ce=c/t,ue=d/t;_.transform=`scale(${t}, ${t}) translate(${ce}px, ${ue}px)`}return _}),v=D(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:c}=e,d=f.value?c/o.imageRatio:t;return Math.max(0,(o.scale*d-t)/2)}return 0}),s=D(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:c}=e,d=f.value?c:t*o.imageRatio;return Math.max(0,(o.scale*d-c)/2)}return 0}),h=t=>{t=X(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,u("scale",{scale:t,index:e.active}))},g=()=>{h(1),o.moveX=0,o.moveY=0},$=()=>{const t=o.scale>1?1:2;h(t),o.moveX=0,o.moveY=0};let S,y,b,a,w,i,x,P=!1;const j=t=>{const{touches:c}=t;if(S=c.length,S===2&&e.disableZoom)return;const{offsetX:d}=n;n.start(t),y=o.moveX,b=o.moveY,x=Date.now(),P=!1,o.moving=S===1&&o.scale!==1,o.zooming=S===2&&!d.value,o.zooming&&(a=o.scale,w=p(t.touches))},se=t=>{const{touches:c}=t;if(n.move(t),o.moving){const{deltaX:d,deltaY:C}=n,z=d.value+y,_=C.value+b;if((z>v.value||z<-v.value)&&!P){o.moving=!1;return}P=!0,M(t,!0),o.moveX=X(z,-v.value,v.value),o.moveY=X(_,-s.value,s.value)}if(o.zooming&&(M(t,!0),c.length===2)){const d=p(c),C=a*d/w;h(C)}},le=()=>{if(S>1)return;const{offsetX:t,offsetY:c}=n,d=Date.now()-x,C=250,z=5;t.value<z&&c.value<z&&(d<C?i?(clearTimeout(i),i=null,$()):i=setTimeout(()=>{u("close"),i=null},C):d>ye&&u("longPress"))},J=t=>{let c=!1;(o.moving||o.zooming)&&(c=!0,o.moving&&y===o.moveX&&b===o.moveY&&(c=!1),t.touches.length||(o.zooming&&(o.moveX=X(o.moveX,-v.value,v.value),o.moveY=X(o.moveY,-s.value,s.value),o.zooming=!1),o.moving=!1,y=0,b=0,a=1,o.scale<1&&g(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),M(t,c),le(),n.reset()},re=t=>{const{naturalWidth:c,naturalHeight:d}=t.target;o.imageRatio=d/c};return E(()=>e.active,g),E(()=>e.show,t=>{t||g()}),Se("touchmove",se,{target:D(()=>{var t;return(t=m.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>l(ne,{type:"spinner"},null)};return l(Le,{ref:m,class:F("swipe-item"),onTouchstartPassive:j,onTouchend:J,onTouchcancel:J},{default:()=>[r.image?l("div",{class:F("image-wrap")},[r.image({src:e.src})]):l(We,{src:e.src,fit:"contain",class:F("image",{vertical:f.value}),style:T.value,onLoad:re},t)]})}}});const[Ae,Z]=A("image-preview"),Ue=["show","teleport","transition","overlayStyle","closeOnPopstate"],je={show:Boolean,loop:L,images:Te(),minZoom:N(1/3),maxZoom:N(3),overlay:L,closeable:Boolean,showIndex:L,className:Q,closeIcon:I("clear"),transition:String,beforeClose:Function,overlayClass:Q,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:L,closeIconPosition:I("top-right"),teleport:[String,Object]};var ie=U({name:Ae,props:je,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:u,slots:r}){const o=Y(),n=ae({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),m=()=>{if(o.value){const i=Ce(o.value.$el);n.rootWidth=i.width,n.rootHeight=i.height,o.value.resize()}},f=i=>u("scale",i),T=i=>u("update:show",i),v=()=>{$e(e.beforeClose,{args:[n.active],done:()=>T(!1)})},s=i=>{i!==n.active&&(n.active=i,u("change",i))},h=()=>{if(e.showIndex)return l("div",{class:Z("index")},[r.index?r.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},g=()=>{if(r.cover)return l("div",{class:Z("cover")},[r.cover()])},$=()=>{n.disableZoom=!0},S=()=>{n.disableZoom=!1},y=()=>l(Ee,{ref:o,lazyRender:!0,loop:e.loop,class:Z("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:s,onDragEnd:S,onDragStart:$},{default:()=>[e.images.map((i,x)=>l(Oe,{src:i,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,onScale:f,onClose:v,onLongPress:()=>u("longPress",{index:x})},{image:r.image}))]}),b=()=>{if(e.closeable)return l(V,{role:"button",name:e.closeIcon,class:[Z("close-icon",e.closeIconPosition),ze],onClick:v},null)},a=()=>u("closed"),w=(i,x)=>{var P;return(P=o.value)==null?void 0:P.swipeTo(i,x)};return Re({swipeTo:w}),te(m),E([be,xe],m),E(()=>e.startPosition,i=>s(+i)),E(()=>e.show,i=>{const{images:x,startPosition:P}=e;i?(s(+P),K(()=>{m(),w(+P,{immediate:!0})})):u("close",{index:n.active,url:x[n.active]})}),()=>l(ke,O({class:[Z(),e.className],overlayClass:[Z("overlay"),e.overlayClass],onClosed:a,"onUpdate:show":T},Ie(e,Ue)),{default:()=>[b(),y(),h(),g()]})}});let W;const qe={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Fe(){({instance:W}=Ze({setup(){const{state:e,toggle:u}=De(),r=()=>{e.images=[]};return()=>l(ie,O(e,{onClosed:r,"onUpdate:show":u}),null)}}))}const Qe=(e,u=0)=>{if(oe)return W||Fe(),e=Array.isArray(e)?{images:e,startPosition:u}:e,W.open(ee({},qe,e)),W};G(ie);export{Je as B,We as I,Qe as s};
