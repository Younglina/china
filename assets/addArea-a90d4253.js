import{c as H,$ as xe,T as P,P as z,d as F,n as K,am as D,ao as $,v as V,Q as de,aU as Ie,K as pe,a as p,O as me,a7 as ee,y as fe,q as R,p as Te,m as Ue,b as O,aV as ke,z as Y,aW as q,aa as ne,S as Ve,N as Ce,aX as Le,w as Oe,aY as Pe,_ as _e,D as Se,x as te,j as J,o as Ee,e as Be,i as N,af as De,ag as Ne,h as oe,ah as $e}from"./index-021851cb.js";import{B as He}from"./index-f1a030fb.js";import"./index-265a5c64.js";/* empty css              */import{U as Fe}from"./index-0d00d251.js";import{T as je,a as Ke}from"./index-e2424429.js";import{A as Re}from"./index-375ac9ee.js";import{F as Ye,a as qe}from"./index-ad61e2d8.js";import{u as Je,a as ve,L as Ge,P as We,s as ze,e as ae,h as le}from"./function-call-4f99f67f.js";import"./use-id-0e83a702.js";const[Qe,C,ie]=H("picker"),ge=e=>e.find(o=>!o.disabled)||e[0];function Xe(e,o){const l=e[0];if(l){if(Array.isArray(l))return"multiple";if(o.children in l)return"cascade"}return"default"}function Q(e,o){o=z(o,0,e.length);for(let l=o;l<e.length;l++)if(!e[l].disabled)return l;for(let l=o-1;l>=0;l--)if(!e[l].disabled)return l;return 0}const ue=(e,o,l)=>o!==void 0&&!!e.find(g=>g[l.value]===o);function X(e,o,l){const g=e.findIndex(u=>u[l.value]===o),m=Q(e,g);return e[m]}function Ze(e,o,l){const g=[];let m={[o.children]:e},u=0;for(;m&&m[o.children];){const c=m[o.children],r=l.value[u];if(m=xe(r)?X(c,r,o):void 0,!m&&c.length){const b=ge(c)[o.value];m=X(c,b,o)}u++,g.push(c)}return g}function en(e){const{transform:o}=window.getComputedStyle(e),l=o.slice(7,o.length-1).split(", ")[5];return Number(l)}function nn(e){return P({text:"text",value:"value",children:"children"},e)}const se=200,ce=300,tn=15,[be,G]=H("picker-column"),he=Symbol(be);var on=F({name:be,props:{value:K,fields:D(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:D(Number),swipeDuration:D(K),visibleOptionNum:D(K)},emits:["change","clickOption"],setup(e,{emit:o,slots:l}){let g,m,u,c,r;const b=V(),T=V(),y=V(0),n=V(0),h=Je(),a=()=>e.options.length,t=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,i=w=>{const I=Q(e.options,w),s=-I*e.optionHeight,d=()=>{const x=e.options[I][e.fields.value];x!==e.value&&o("change",x)};g&&s!==y.value?r=d:d(),y.value=s},A=()=>e.readonly||!e.options.length,M=w=>{g||A()||(r=null,n.value=se,i(w),o("clickOption",e.options[w]))},f=w=>z(Math.round(-w/e.optionHeight),0,a()-1),U=(w,I)=>{const s=Math.abs(w/I);w=y.value+s/.003*(w<0?-1:1);const d=f(w);n.value=+e.swipeDuration,i(d)},k=()=>{g=!1,n.value=0,r&&(r(),r=null)},L=w=>{if(!A()){if(h.start(w),g){const I=en(T.value);y.value=Math.min(0,I-t())}n.value=0,m=y.value,u=Date.now(),c=m,r=null}},v=w=>{if(A())return;h.move(w),h.isVertical()&&(g=!0,me(w,!0)),y.value=z(m+h.deltaY.value,-(a()*e.optionHeight),e.optionHeight);const I=Date.now();I-u>ce&&(u=I,c=y.value)},S=()=>{if(A())return;const w=y.value-c,I=Date.now()-u;if(I<ce&&Math.abs(w)>tn){U(w,I);return}const d=f(y.value);n.value=se,i(d),setTimeout(()=>{g=!1},0)},E=()=>{const w={height:`${e.optionHeight}px`};return e.options.map((I,s)=>{const d=I[e.fields.text],{disabled:x}=I,B=I[e.fields.value],_={role:"button",style:w,tabindex:x?-1:0,class:[G("item",{disabled:x,selected:B===e.value}),I.className],onClick:()=>M(s)},ye={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:d};return p("li",_,[l.option?l.option(I):p("div",ye,null)])})};return de(he),ve({stopMomentum:k}),Ie(()=>{const w=e.options.findIndex(d=>d[e.fields.value]===e.value),s=-Q(e.options,w)*e.optionHeight;y.value=s}),pe("touchmove",v,{target:b}),()=>p("div",{ref:b,class:G(),onTouchstartPassive:L,onTouchend:S,onTouchcancel:S},[p("ul",{ref:T,style:{transform:`translate3d(0, ${y.value+t()}px, 0)`,transitionDuration:`${n.value}ms`,transitionProperty:n.value?"all":"none"},class:G("wrapper"),onTransitionend:k},[E()])])}});const[an]=H("picker-toolbar"),j={title:String,cancelButtonText:String,confirmButtonText:String},ln=["cancel","confirm","title","toolbar"],un=Object.keys(j);var Ae=F({name:an,props:j,emits:["confirm","cancel"],setup(e,{emit:o,slots:l}){const g=()=>{if(l.title)return l.title();if(e.title)return p("div",{class:[C("title"),"van-ellipsis"]},[e.title])},m=()=>o("cancel"),u=()=>o("confirm"),c=()=>{const b=e.cancelButtonText||ie("cancel");return p("button",{type:"button",class:[C("cancel"),ee],onClick:m},[l.cancel?l.cancel():b])},r=()=>{const b=e.confirmButtonText||ie("confirm");return p("button",{type:"button",class:[C("confirm"),ee],onClick:u},[l.confirm?l.confirm():b])};return()=>p("div",{class:C("toolbar")},[l.toolbar?l.toolbar():[c(),g(),r()]])}});const[we,W]=H("picker-group"),Me=Symbol(we),sn=P({tabs:$(),nextStepText:String},j);F({name:we,props:sn,emits:["confirm","cancel"],setup(e,{emit:o,slots:l}){const g=V(0),{children:m,linkChildren:u}=fe(Me);u();const c=()=>g.value<e.tabs.length-1&&e.nextStepText,r=()=>{c()?g.value++:o("confirm",m.map(T=>T.confirm()))},b=()=>o("cancel");return()=>{var T;const y=(T=l.default)==null?void 0:T.call(l),n=c()?e.nextStepText:e.confirmButtonText;return p("div",{class:W()},[p(Ae,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:n,onConfirm:r,onCancel:b},null),p(je,{active:g.value,"onUpdate:active":h=>g.value=h,class:W("tabs"),shrink:!0,animated:!0},{default:()=>[e.tabs.map((h,a)=>p(Ke,{title:h,titleClass:W("tab-title")},{default:()=>[y==null?void 0:y[a]]}))]})])}}});const cn=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:R(44),showToolbar:Te,swipeDuration:R(1e3),visibleOptionNum:R(6)},j),rn=P({},cn,{columns:$(),modelValue:$(),toolbarPosition:Ue("top"),columnsFieldNames:Object});var dn=F({name:Qe,props:rn,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:o,slots:l}){const g=V(),m=V(e.modelValue.slice(0)),{parent:u}=de(Me),{children:c,linkChildren:r}=fe(he);r();const b=O(()=>nn(e.columnsFieldNames)),T=O(()=>ke(e.optionHeight)),y=O(()=>Xe(e.columns,b.value)),n=O(()=>{const{columns:s}=e;switch(y.value){case"multiple":return s;case"cascade":return Ze(s,b.value,m);default:return[s]}}),h=O(()=>n.value.some(s=>s.length)),a=O(()=>n.value.map((s,d)=>X(s,m.value[d],b.value))),t=O(()=>n.value.map((s,d)=>s.findIndex(x=>x[b.value.value]===m.value[d]))),i=(s,d)=>{if(m.value[s]!==d){const x=m.value.slice(0);x[s]=d,m.value=x}},A=()=>({selectedValues:m.value.slice(0),selectedOptions:a.value,selectedIndexes:t.value}),M=(s,d)=>{i(d,s),y.value==="cascade"&&m.value.forEach((x,B)=>{const _=n.value[B];ue(_,x,b.value)||i(B,_.length?_[0][b.value.value]:void 0)}),o("change",P({columnIndex:d},A()))},f=(s,d)=>o("clickOption",P({columnIndex:d,currentOption:s},A())),U=()=>{c.forEach(d=>d.stopMomentum());const s=A();return Ce(()=>{o("confirm",s)}),s},k=()=>o("cancel",A()),L=()=>n.value.map((s,d)=>p(on,{value:m.value[d],fields:b.value,options:s,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:T.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:x=>M(x,d),onClickOption:x=>f(x,d)},{option:l.option})),v=s=>{if(h.value){const d={height:`${T.value}px`},x={backgroundSize:`100% ${(s-T.value)/2}px`};return[p("div",{class:C("mask"),style:x},null),p("div",{class:[Le,C("frame")],style:d},null)]}},S=()=>{const s=T.value*+e.visibleOptionNum,d={height:`${s}px`};return p("div",{ref:g,class:C("columns"),style:d},[L(),v(s)])},E=()=>{if(e.showToolbar&&!u)return p(Ae,Ve(ne(e,un),{onConfirm:U,onCancel:k}),ne(l,ln))};Y(n,s=>{s.forEach((d,x)=>{d.length&&!ue(d,m.value[x],b.value)&&i(x,ge(d)[b.value.value])})},{immediate:!0});let w;return Y(()=>e.modelValue,s=>{!q(s,m.value)&&!q(s,w)&&(m.value=s.slice(0))},{deep:!0}),Y(m,s=>{q(s,e.modelValue)||(w=s.slice(0),o("update:modelValue",w))},{immediate:!0}),pe("touchmove",me,{target:g}),ve({confirm:U,getSelectedOptions:()=>a.value}),()=>{var s,d;return p("div",{class:C()},[e.toolbarPosition==="top"?E():null,e.loading?p(Ge,{class:C("loading")},null):null,(s=l["columns-top"])==null?void 0:s.call(l),S(),(d=l["columns-bottom"])==null?void 0:d.call(l),e.toolbarPosition==="bottom"?E():null])}}});const pn=Oe(dn);var Z={},mn={get exports(){return Z},set exports(e){Z=e}};(function(e,o){(function(l,g){e.exports=g()})(Pe,function(){function l(n){var h=[];return n.AMapUI&&h.push(g(n.AMapUI)),n.Loca&&h.push(m(n.Loca)),Promise.all(h)}function g(n){return new Promise(function(h,a){var t=[];if(n.plugins)for(var i=0;i<n.plugins.length;i+=1)c.AMapUI.plugins.indexOf(n.plugins[i])==-1&&t.push(n.plugins[i]);if(r.AMapUI===u.failed)a("前次请求 AMapUI 失败");else if(r.AMapUI===u.notload){r.AMapUI=u.loading,c.AMapUI.version=n.version||c.AMapUI.version,i=c.AMapUI.version;var A=document.body||document.head,M=document.createElement("script");M.type="text/javascript",M.src="https://webapi.amap.com/ui/"+i+"/main.js",M.onerror=function(f){r.AMapUI=u.failed,a("请求 AMapUI 失败")},M.onload=function(){if(r.AMapUI=u.loaded,t.length)window.AMapUI.loadUI(t,function(){for(var f=0,U=t.length;f<U;f++){var k=t[f].split("/").slice(-1)[0];window.AMapUI[k]=arguments[f]}for(h();b.AMapUI.length;)b.AMapUI.splice(0,1)[0]()});else for(h();b.AMapUI.length;)b.AMapUI.splice(0,1)[0]()},A.appendChild(M)}else r.AMapUI===u.loaded?n.version&&n.version!==c.AMapUI.version?a("不允许多个版本 AMapUI 混用"):t.length?window.AMapUI.loadUI(t,function(){for(var f=0,U=t.length;f<U;f++){var k=t[f].split("/").slice(-1)[0];window.AMapUI[k]=arguments[f]}h()}):h():n.version&&n.version!==c.AMapUI.version?a("不允许多个版本 AMapUI 混用"):b.AMapUI.push(function(f){f?a(f):t.length?window.AMapUI.loadUI(t,function(){for(var U=0,k=t.length;U<k;U++){var L=t[U].split("/").slice(-1)[0];window.AMapUI[L]=arguments[U]}h()}):h()})})}function m(n){return new Promise(function(h,a){if(r.Loca===u.failed)a("前次请求 Loca 失败");else if(r.Loca===u.notload){r.Loca=u.loading,c.Loca.version=n.version||c.Loca.version;var t=c.Loca.version,i=c.AMap.version.startsWith("2"),A=t.startsWith("2");if(i&&!A||!i&&A)a("JSAPI 与 Loca 版本不对应！！");else{i=c.key,A=document.body||document.head;var M=document.createElement("script");M.type="text/javascript",M.src="https://webapi.amap.com/loca?v="+t+"&key="+i,M.onerror=function(f){r.Loca=u.failed,a("请求 AMapUI 失败")},M.onload=function(){for(r.Loca=u.loaded,h();b.Loca.length;)b.Loca.splice(0,1)[0]()},A.appendChild(M)}}else r.Loca===u.loaded?n.version&&n.version!==c.Loca.version?a("不允许多个版本 Loca 混用"):h():n.version&&n.version!==c.Loca.version?a("不允许多个版本 Loca 混用"):b.Loca.push(function(f){f?a(f):a()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var u;(function(n){n.notload="notload",n.loading="loading",n.loaded="loaded",n.failed="failed"})(u||(u={}));var c={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},r={AMap:u.notload,AMapUI:u.notload,Loca:u.notload},b={AMap:[],AMapUI:[],Loca:[]},T=[],y=function(n){typeof n=="function"&&(r.AMap===u.loaded?n(window.AMap):T.push(n))};return{load:function(n){return new Promise(function(h,a){if(r.AMap==u.failed)a("");else if(r.AMap==u.notload){var t=n.key,i=n.version,A=n.plugins;t?(window.AMap&&location.host!=="lbs.amap.com"&&a("禁止多种API加载方式混用"),c.key=t,c.AMap.version=i||c.AMap.version,c.AMap.plugins=A||c.AMap.plugins,r.AMap=u.loading,i=document.body||document.head,window.___onAPILoaded=function(f){if(delete window.___onAPILoaded,f)r.AMap=u.failed,a(f);else for(r.AMap=u.loaded,l(n).then(function(){h(window.AMap)}).catch(a);T.length;)T.splice(0,1)[0]()},A=document.createElement("script"),A.type="text/javascript",A.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+c.AMap.version+"&key="+t+"&plugin="+c.AMap.plugins.join(","),A.onerror=function(f){r.AMap=u.failed,a(f)},i.appendChild(A)):a("请填写key")}else if(r.AMap==u.loaded)if(n.key&&n.key!==c.key)a("多个不一致的 key");else if(n.version&&n.version!==c.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(t=[],n.plugins)for(i=0;i<n.plugins.length;i+=1)c.AMap.plugins.indexOf(n.plugins[i])==-1&&t.push(n.plugins[i]);t.length?window.AMap.plugin(t,function(){l(n).then(function(){h(window.AMap)}).catch(a)}):l(n).then(function(){h(window.AMap)}).catch(a)}else if(n.key&&n.key!==c.key)a("多个不一致的 key");else if(n.version&&n.version!==c.AMap.version)a("不允许多个版本 JSAPI 混用");else{var M=[];if(n.plugins)for(i=0;i<n.plugins.length;i+=1)c.AMap.plugins.indexOf(n.plugins[i])==-1&&M.push(n.plugins[i]);y(function(){M.length?window.AMap.plugin(M,function(){l(n).then(function(){h(window.AMap)}).catch(a)}):l(n).then(function(){h(window.AMap)}).catch(a)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,c={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},r={AMap:u.notload,AMapUI:u.notload,Loca:u.notload},b={AMap:[],AMapUI:[],Loca:[]}}}})})(mn);const re=Z;const fn={class:"add-page"},vn={__name:"addArea",setup(e){Se(()=>{window._AMapSecurityConfig={securityJsCode:"1798020d0518464df4e389ee55365c02"},re.load({key:"c35481dff089b8a651daaca8ed71c38c",version:"2.0",plugins:["AMap.Autocomplete"]})});const o=te({name:"",key:"",tags:"",locat:"",areaType:"",lng:"",lat:"",address:"",desc:"",phone:"",openTime:"",cost:"",introduction:"",images:[]}),l=V(J[0].text),g=V(!1),m=V(!1),u=V([]),c=async()=>{m.value=!0,ze({message:"提交中...",duration:0,forbidClick:!0,loadingType:"spinner"});try{const a={...o},t=+new Date;a.tags=a.tags.replaceAll("，",",").split(",");const i=a.key;a.key=`${i}wy${t}`;const A=J.find(M=>M.text===l.value).value;a.dataType=A,await De(A,a),Ne(a.key,u.value,t),ae({message:"提交成功",duration:1e3}),m.value=!1,setTimeout(()=>{router.go(-1)},1200)}catch(a){console.dir(a),ae({message:"提交出错",duration:1e3}),m.value=!1}},r=a=>{console.log("failed",a)},b=({selectedOptions:a})=>{g.value=!1,l.value=a[0].text};let T=te([]);const y=V(!1),n=()=>{if(!o.name){le("请先填写名称");return}re.load(["AMap.Autocomplete"]).then(a=>{a.plugin("AMap.AutoComplete",()=>{const t={city:"江西省",citylimit:!0};new a.Autocomplete(t).search("景德镇市"+o.name,function(A,M){T=M.tips.map(f=>({name:f.name,subname:f.address,district:f.district,lnglat:f.location?`${f.location.lng},${f.location.lat}`:""})),y.value=!0})})}).catch(a=>{console.error(a),le("查询详细地址失败")})},h=a=>{o.address=a.district+a.subname;const t=a.lnglat.split(",");t.length>0&&(o.lng=t[0],o.lat=t[1]),y.value=!1};return(a,t)=>{const i=Ye,A=Re,M=pn,f=We,U=Fe,k=He,L=qe;return Ee(),Be("div",fn,[p(L,{ref:"form","label-width":"100px",onSubmit:c,onFailed:r},{default:N(()=>[p(i,{modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=v=>o.name=v),label:"名称",placeholder:"请输入名称",required:""},null,8,["modelValue"]),p(i,{modelValue:o.key,"onUpdate:modelValue":t[1]||(t[1]=v=>o.key=v),label:"关键字",placeholder:"拼音首字母缩写",required:""},null,8,["modelValue"]),p(i,{modelValue:o.locat,"onUpdate:modelValue":t[2]||(t[2]=v=>o.locat=v),label:"所在地",placeholder:"大致街区，如昌江区",required:""},null,8,["modelValue"]),p(i,{modelValue:o.address,"onUpdate:modelValue":t[3]||(t[3]=v=>o.address=v),"is-link":"",readonly:"",label:"详细地址",placeholder:"请选择详细地址",onClick:n},null,8,["modelValue"]),p(A,{show:y.value,"onUpdate:show":t[4]||(t[4]=v=>y.value=v),actions:oe(T),"cancel-text":"取消",description:"请选择详细地址",onSelect:h,"close-on-click-action":""},null,8,["show","actions"]),p(i,{modelValue:l.value,"onUpdate:modelValue":t[5]||(t[5]=v=>l.value=v),"is-link":"",readonly:"",label:"数据类型",placeholder:"选择数据类型",onClick:t[6]||(t[6]=v=>g.value=!0)},null,8,["modelValue"]),p(f,{show:g.value,"onUpdate:show":t[8]||(t[8]=v=>g.value=v),round:"",position:"bottom"},{default:N(()=>[p(M,{columns:oe(J),onCancel:t[7]||(t[7]=v=>g.value=!1),onConfirm:b},null,8,["columns"])]),_:1},8,["show"]),p(i,{modelValue:o.tags,"onUpdate:modelValue":t[9]||(t[9]=v=>o.tags=v),label:"标签",placeholder:"用逗号隔开，如昌江区，博物馆"},null,8,["modelValue"]),p(i,{modelValue:o.areaType,"onUpdate:modelValue":t[10]||(t[10]=v=>o.areaType=v),label:"类型",placeholder:"如博物馆、商场、餐馆"},null,8,["modelValue"]),p(i,{modelValue:o.phone,"onUpdate:modelValue":t[11]||(t[11]=v=>o.phone=v),label:"联系电话",placeholder:"请输入联系电话"},null,8,["modelValue"]),p(i,{modelValue:o.openTime,"onUpdate:modelValue":t[12]||(t[12]=v=>o.openTime=v),label:"开放时间",placeholder:"请输入开放时间"},null,8,["modelValue"]),p(i,{modelValue:o.cost,"onUpdate:modelValue":t[13]||(t[13]=v=>o.cost=v),label:"人均消费",placeholder:"请输入人均消费"},null,8,["modelValue"]),p(i,{modelValue:o.desc,"onUpdate:modelValue":t[14]||(t[14]=v=>o.desc=v),label:"描述",type:"textarea",rows:"3",placeholder:"请输入一句话描述"},null,8,["modelValue"]),p(i,{modelValue:o.introduction,"onUpdate:modelValue":t[15]||(t[15]=v=>o.introduction=v),label:"详细介绍",type:"textarea",rows:"3",placeholder:"请输入详细介绍"},null,8,["modelValue"]),p(i,{name:"uploader",label:"图片上传"},{input:N(()=>[p(U,{modelValue:u.value,"onUpdate:modelValue":t[16]||(t[16]=v=>u.value=v),multiple:"","max-count":9},null,8,["modelValue"])]),_:1}),p(k,{round:"",block:"",type:"primary","native-type":"submit","loading-type":"spinner",loading:m.value},{default:N(()=>[$e("提交")]),_:1},8,["loading"])]),_:1},512)])}}},Un=_e(vn,[["__scopeId","data-v-dc16d2c3"]]);export{Un as default};
