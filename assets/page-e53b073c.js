import{_ as V,ae as k,u as w,x as C,v as g,o as I,l as $,i as r,k as B,af as D,ag as L,a as n,h as d,f as N,ah as v}from"./index-021851cb.js";import{B as S}from"./index-f1a030fb.js";import{C as U}from"./index-4432f52f.js";import"./index-265a5c64.js";/* empty css              */import{U as z}from"./index-0d00d251.js";import{F,a as j}from"./index-ad61e2d8.js";import{H}from"./request-2dd4c383.js";import{c as b,s as Q,d as R,e as q}from"./function-call-4f99f67f.js";import"./index-0aee9122.js";import"./use-id-0e83a702.js";const A={class:"action-button"},G={__name:"page",setup(K){const y=k(),_=w();let s=C({content:""});const t=g([]),u=g(!1),{areaKey:c,areaName:f,dataType:x}=y.query;async function h(){const l=B();if(!l.userInfo){b("请去我的页面进行登录或注册");return}if(!s.content&&!t.value.length){b("还没有填写内容或图片哦");return}if(u.value===!0)return;u.value=!0,Q({message:"提交中...",duration:0,forbidClick:!0,loadingType:"spinner"});let e=[];const a=new Date;t.value.length&&(e=t.value.map(o=>`${c}_${+a}_${o.file.name}`));const m=a.toLocaleString().replaceAll("/","-"),p={content:s.content,images:e,datetime:m};await D("verify",{...p,datetime:m,nickname:l.userInfo.username,userid:l.userInfo.userid,areaKey:c,areaName:f,dataType:x}),H.post("https://944f70db8a9d4b4b8cd0254eaf917b88.apig.cn-east-3.huaweicloudapis.com/sendQQMail",{subject:`${l.userInfo.username}-评论-${f}`,text:s.content},{headers:{"Content-Type":"text/plain"}}).then(o=>{console.log(o)}),L(c,t.value,+a),R(),q({message:"提交成功，审核后将会显示。",duration:1200}),setTimeout(()=>{_.go(-1),u.value=!1},1300)}return(l,e)=>{const a=F,m=z,p=U,o=S,T=j;return I(),$(T,{class:"commnet-form",onSubmit:h},{default:r(()=>[n(p,{inset:""},{default:r(()=>[n(a,{modelValue:d(s).content,"onUpdate:modelValue":e[0]||(e[0]=i=>d(s).content=i),style:{"margin-bottom":"10px"},label:"留言",rows:"2",autosize:"",type:"textarea",placeholder:"说点什么吧~"},null,8,["modelValue"]),n(a,{name:"uploader",label:"图片上传"},{input:r(()=>[n(m,{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value=i),multiple:"","max-count":9},null,8,["modelValue"])]),_:1})]),_:1}),N("div",A,[n(o,{block:"",size:"small",round:"",type:"success",onClick:e[2]||(e[2]=i=>d(_).go(-1))},{default:r(()=>[v(" 取消 ")]),_:1}),n(o,{block:"",size:"small",round:"",type:"primary","native-type":"submit",loading:u.value,"loading-text":"提交中..."},{default:r(()=>[v(" 提交 ")]),_:1},8,["loading"])])]),_:1})}}},ae=V(G,[["__scopeId","data-v-82ab6bf9"]]);export{ae as default};
