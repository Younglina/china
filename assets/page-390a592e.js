import{_ as V,ae as w,u as h,x as C,v,o as I,l as $,i as l,k as B,af as D,ag as z,a,h as d,f as L,ah as g}from"./index-002d2008.js";import{B as N}from"./index-97608de8.js";import{C as S}from"./index-c732ceac.js";import"./index-d0a5e39a.js";/* empty css              */import{U}from"./index-a0960584.js";import{F as j,a as F}from"./index-cf53b1b4.js";import{H}from"./request-2dd4c383.js";import{c as y,s as R,d as q,e as A}from"./function-call-85b48d00.js";import"./index-c48dbb77.js";import"./use-id-fff503f2.js";const G={class:"action-button"},K={__name:"page",setup(O){const b=w(),_=h();let n=C({content:""});const t=v([]),r=v(!1),{areaKey:c,areaName:f,dataType:x}=b.query;async function k(){const s=B();if(!s.userInfo){y("请去我的页面进行登录或注册");return}if(!n.content&&!t.value.length){y("还没有填写内容或图片哦");return}if(r.value===!0)return;r.value=!0,R({message:"提交中...",duration:0,forbidClick:!0,loadingType:"spinner"});let e=[];const o=new Date;t.value.length&&(e=t.value.map(m=>`${c}_${+o}_${m.file.name}`));const u=o.toLocaleString().replaceAll("/","-"),p={content:n.content,images:e,datetime:u};await D("verify",{...p,datetime:u,nickname:s.userInfo.username,userid:s.userInfo.userid,areaKey:c,areaName:f,dataType:x}),H.post("https://service-2knv5vd8-1256042946.gz.apigw.tencentcs.com/release/sendmail",{subject:`${s.userInfo.username}-评论-${f}`,text:n.content},{headers:{"Content-Type":"application/json"}}),z(c,t.value,+o),q(),A({message:"提交成功，审核后将会显示。",duration:1200}),setTimeout(()=>{_.go(-1),r.value=!1},1300)}return(s,e)=>{const o=j,u=U,p=S,m=N,T=F;return I(),$(T,{class:"commnet-form",onSubmit:k},{default:l(()=>[a(p,{inset:""},{default:l(()=>[a(o,{modelValue:d(n).content,"onUpdate:modelValue":e[0]||(e[0]=i=>d(n).content=i),style:{"margin-bottom":"10px"},label:"留言",rows:"2",autosize:"",type:"textarea",placeholder:"说点什么吧~"},null,8,["modelValue"]),a(o,{name:"uploader",label:"图片上传"},{input:l(()=>[a(u,{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value=i),multiple:"","max-count":9},null,8,["modelValue"])]),_:1})]),_:1}),L("div",G,[a(m,{block:"",size:"small",round:"",type:"success",onClick:e[2]||(e[2]=i=>d(_).go(-1))},{default:l(()=>[g(" 取消 ")]),_:1}),a(m,{block:"",size:"small",round:"",type:"primary","native-type":"submit",loading:r.value,"loading-text":"提交中..."},{default:l(()=>[g(" 提交 ")]),_:1},8,["loading"])])]),_:1})}}},oe=V(K,[["__scopeId","data-v-8a6f3f52"]]);export{oe as default};
